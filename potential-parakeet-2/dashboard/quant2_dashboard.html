<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quant 2.0 Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/universe-selector.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a1a;
            --bg-secondary: #12122a;
            --bg-card: #1a1a3a;
            --accent: #00d4ff;
            --accent-alt: #7b68ee;
            --success: #00ff88;
            --danger: #ff4466;
            --warning: #ffaa00;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --border: #2a2a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            padding: 20px 40px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }

        .logo span {
            color: var(--text-primary);
        }

        .version-badge {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-alt) 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 12px;
        }

        .header-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        .nav-link.active {
            color: var(--accent);
            font-weight: 600;
        }

        /* Main Layout */
        main {
            padding: 30px 40px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Section Titles */
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent);
            border-radius: 2px;
        }

        /* Regime Status */
        .regime-banner {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .regime-indicator {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .regime-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .regime-dot.bull {
            background: var(--success);
            box-shadow: 0 0 20px var(--success);
        }

        .regime-dot.bear {
            background: var(--danger);
            box-shadow: 0 0 20px var(--danger);
        }

        .regime-dot.chop {
            background: var(--warning);
            box-shadow: 0 0 20px var(--warning);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .regime-label {
            font-size: 24px;
            font-weight: 700;
        }

        .regime-probs {
            display: flex;
            gap: 20px;
            margin-left: auto;
        }

        .prob-item {
            text-align: center;
        }

        .prob-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .prob-value {
            font-size: 18px;
            font-weight: 600;
        }

        /* Strategy Cards Grid */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .strategy-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .strategy-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.2);
        }

        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .strategy-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent);
        }

        .strategy-desc {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 4px;
        }

        .strategy-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-residual {
            background: rgba(123, 104, 238, 0.2);
            color: #7b68ee;
        }

        .badge-statarb {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .badge-regime {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .badge-meta {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .badge-vol {
            background: rgba(255, 68, 102, 0.2);
            color: #ff4466;
        }

        .strategy-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .metric-value {
            font-weight: 600;
        }

        .metric-value.positive {
            color: var(--success);
        }

        .metric-value.negative {
            color: var(--danger);
        }

        .metric-value.neutral {
            color: var(--accent);
        }

        /* Allocation Chart */
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        /* Activity Feed */
        .activity-feed {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .activity-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .activity-icon.signal {
            background: rgba(0, 212, 255, 0.2);
        }

        .activity-icon.trade {
            background: rgba(0, 255, 136, 0.2);
        }

        .activity-icon.alert {
            background: rgba(255, 68, 102, 0.2);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .activity-desc {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .activity-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 16px;
            }

            main {
                padding: 20px;
            }

            .regime-banner,
            .universe-banner {
                flex-direction: column;
                align-items: flex-start;
            }

            .regime-probs {
                margin-left: 0;
                margin-top: 16px;
            }

            .universe-stats {
                margin-left: 0;
                margin-top: 12px;
            }
        }

        /* Universe Selector Banner */
        .universe-banner {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .universe-stats {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .universe-stat {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .universe-stat strong {
            color: var(--accent);
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">Quant<span>2.0</span><span class="version-badge">Beta</span></div>
        <div class="header-nav">
            <a href="strategy_dashboard.html" class="nav-link"
                style="background: rgba(160, 160, 192, 0.2); padding: 6px 14px; border-radius: 8px;">üìä Quant 1.0</a>
            <a href="quant2_dashboard.html" class="nav-link active"
                style="background: linear-gradient(135deg, #00d4ff 0%, #7b68ee 100%); color: white; padding: 6px 14px; border-radius: 8px;">üìä
                Quant 2.0</a>
            <a href="update_schedule.html" class="nav-link">üìÖ Schedule</a>
            <a href="quant2_strategy_guide.html" class="nav-link">üìñ Guide</a>
            <a href="quant2_residual_momentum.html" class="nav-link">üìà Residual Momentum</a>
            <a href="quant2_stat_arb.html" class="nav-link">üîÑ Stat Arb</a>
            <a href="quant2_regime.html" class="nav-link">üéØ Regime</a>
            <a href="quant2_meta_labeling.html" class="nav-link">ü§ñ Meta-Label</a>
        </div>
    </header>

    <main>
        <!-- Universe Selector Section -->
        <div class="universe-banner">
            <div id="universe-selector-container"></div>
            <div class="universe-stats" id="universe-stats">
                <span class="universe-stat">Loading...</span>
            </div>
        </div>

        <!-- Regime Status Banner -->
        <div class="regime-banner">
            <div class="regime-indicator">
                <div class="regime-dot bull" id="regimeDot"></div>
                <div>
                    <div class="regime-label" id="currentRegime">BULL</div>
                    <div style="color: var(--text-secondary); font-size: 13px;">Current Market Regime</div>
                </div>
            </div>
            <div class="regime-probs" id="regimeProbs">
                <div class="prob-item">
                    <div class="prob-label">Bull</div>
                    <div class="prob-value" style="color: var(--success);" id="bullProb">72%</div>
                </div>
                <div class="prob-item">
                    <div class="prob-label">Bear</div>
                    <div class="prob-value" style="color: var(--danger);" id="bearProb">8%</div>
                </div>
                <div class="prob-item">
                    <div class="prob-label">Chop</div>
                    <div class="prob-value" style="color: var(--warning);" id="chopProb">20%</div>
                </div>
            </div>
        </div>

        <!-- Strategy Cards -->
        <h2 class="section-title">Quant 2.0 Strategies</h2>
        <div class="strategy-grid">
            <a href="quant2_residual_momentum.html" class="strategy-card">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">Residual Momentum</div>
                        <div class="strategy-desc">Factor-neutral momentum via Fama-French</div>
                    </div>
                    <span class="strategy-badge badge-residual">Momentum</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Top Score</span>
                        <span class="metric-value positive" id="rmTopScore">2.34</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Stocks Ranked</span>
                        <span class="metric-value neutral" id="rmStocks">48</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Avg R¬≤</span>
                        <span class="metric-value neutral" id="rmR2">0.42</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Status</span>
                        <span class="metric-value positive">Active</span>
                    </div>
                </div>
            </a>

            <a href="quant2_stat_arb.html" class="strategy-card">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">Statistical Arbitrage</div>
                        <div class="strategy-desc">PCA + DBSCAN clustering, Kalman pairs</div>
                    </div>
                    <span class="strategy-badge badge-statarb">Stat Arb</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Active Pairs</span>
                        <span class="metric-value neutral" id="saPairs">12</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Clusters</span>
                        <span class="metric-value neutral" id="saClusters">5</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Avg Half-Life</span>
                        <span class="metric-value neutral" id="saHalfLife">8.2d</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Signals Today</span>
                        <span class="metric-value positive" id="saSignals">3</span>
                    </div>
                </div>
            </a>

            <a href="quant2_regime.html" class="strategy-card">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">Regime Allocation</div>
                        <div class="strategy-desc">HMM-driven dynamic weights</div>
                    </div>
                    <span class="strategy-badge badge-regime">Regime</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Current</span>
                        <span class="metric-value positive" id="raRegime">BULL</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Confidence</span>
                        <span class="metric-value neutral" id="raConf">72%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Days in Regime</span>
                        <span class="metric-value neutral" id="raDays">34</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Last Switch</span>
                        <span class="metric-value neutral" id="raSwitch">Nov 22</span>
                    </div>
                </div>
            </a>

            <a href="quant2_meta_labeling.html" class="strategy-card">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">Meta-Labeling</div>
                        <div class="strategy-desc">ML-filtered Quallamaggie signals</div>
                    </div>
                    <span class="strategy-badge badge-meta">Meta-ML</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Signals Today</span>
                        <span class="metric-value neutral" id="mlSignals">7</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Accepted</span>
                        <span class="metric-value positive" id="mlAccepted">3</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Model AUC</span>
                        <span class="metric-value neutral" id="mlAuc">0.71</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Filter Rate</span>
                        <span class="metric-value neutral" id="mlFilter">57%</span>
                    </div>
                </div>
            </a>

            <div class="strategy-card" style="cursor: default;">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">Short Volatility</div>
                        <div class="strategy-desc">VIX-based signals (VRP)</div>
                    </div>
                    <span class="strategy-badge badge-vol">Volatility</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">VIX</span>
                        <span class="metric-value neutral" id="vrpVix">14.2</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Percentile</span>
                        <span class="metric-value positive" id="vrpPct">22%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Signal</span>
                        <span class="metric-value positive" id="vrpSignal">HARVEST</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Term Struct</span>
                        <span class="metric-value neutral" id="vrpTerm">Contango</span>
                    </div>
                </div>
            </div>

            <div class="strategy-card" style="cursor: default;">
                <div class="strategy-header">
                    <div>
                        <div class="strategy-name">NCO Optimizer</div>
                        <div class="strategy-desc">Nested Clustered Optimization</div>
                    </div>
                    <span class="strategy-badge badge-statarb">Optimizer</span>
                </div>
                <div class="strategy-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Effective N</span>
                        <span class="metric-value neutral" id="ncoN">8.4</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Max Weight</span>
                        <span class="metric-value neutral" id="ncoMax">18%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Exp Return</span>
                        <span class="metric-value positive" id="ncoRet">12.4%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Exp Vol</span>
                        <span class="metric-value neutral" id="ncoVol">8.2%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <h2 class="section-title">Portfolio Overview</h2>
        <div class="charts-row">
            <div class="chart-card">
                <div class="chart-title">Current Allocation</div>
                <canvas id="allocationChart"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">Strategy Performance (YTD)</div>
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <!-- Activity Feed -->
        <h2 class="section-title">Recent Activity</h2>
        <div class="activity-feed" id="activityFeed">
            <div class="activity-item">
                <div class="activity-icon signal">üìä</div>
                <div class="activity-content">
                    <div class="activity-title">Regime Change Detected</div>
                    <div class="activity-desc">HMM transitioned from CHOP to BULL (72% confidence)</div>
                </div>
                <div class="activity-time">2 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon trade">‚úÖ</div>
                <div class="activity-content">
                    <div class="activity-title">Meta-Label Signal: AAPL</div>
                    <div class="activity-desc">Quallamaggie breakout accepted (P=0.78)</div>
                </div>
                <div class="activity-time">4 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon signal">üîÑ</div>
                <div class="activity-content">
                    <div class="activity-title">Pairs Trade: MSFT/GOOGL</div>
                    <div class="activity-desc">Z-score reached -2.1, long spread signal</div>
                </div>
                <div class="activity-time">6 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon alert">‚ö†Ô∏è</div>
                <div class="activity-content">
                    <div class="activity-title">VIX Alert</div>
                    <div class="activity-desc">VIX dropped below 20th percentile - favorable for short vol</div>
                </div>
                <div class="activity-time">Yesterday</div>
            </div>
        </div>
    </main>

    <script>
        // Initialize charts after Chart.js is fully loaded
        // Attach to window object to make it globally accessible for setTimeout retry
        window.initializeCharts = function () {
            if (typeof Chart === 'undefined') {
                // Chart.js not ready yet, retry in 100ms
                setTimeout(window.initializeCharts, 100);
                return;
            }

            // Chart Configuration
            Chart.defaults.color = '#a0a0c0';
            Chart.defaults.borderColor = '#2a2a4a';

            // Allocation Pie Chart
            const allocationCanvas = document.getElementById('allocationChart');
            if (allocationCanvas && !Chart.getChart(allocationCanvas)) {
                const allocationCtx = allocationCanvas.getContext('2d');
                new Chart(allocationCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Residual Momentum', 'Stat Arb', 'Short Vol', 'Cash'],
                        datasets: [{
                            data: [40, 25, 20, 15],
                            backgroundColor: ['#7b68ee', '#00ff88', '#ff4466', '#666680'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }

            // Performance Bar Chart
            const performanceCanvas = document.getElementById('performanceChart');
            if (performanceCanvas && !Chart.getChart(performanceCanvas)) {
                const perfCtx = performanceCanvas.getContext('2d');
                new Chart(perfCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Res Mom', 'Stat Arb', 'Regime', 'Meta-Label', 'Short Vol'],
                        datasets: [{
                            label: 'YTD Return %',
                            data: [18.2, 12.4, 15.1, 22.3, 8.7],
                            backgroundColor: ['#7b68ee', '#00ff88', '#ffaa00', '#00d4ff', '#ff4466']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#2a2a4a' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            console.log('Charts initialized successfully');
        }

        // Run initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', window.initializeCharts);
        } else {
            // DOM already loaded
            window.initializeCharts();
        }

        // Also run on window load as backup
        window.addEventListener('load', window.initializeCharts);

        // Update regime based on data
        function updateRegime(regime, probs) {
            const dot = document.getElementById('regimeDot');
            const label = document.getElementById('currentRegime');

            dot.className = 'regime-dot ' + regime.toLowerCase();
            label.textContent = regime;

            document.getElementById('bullProb').textContent = Math.round(probs.bull * 100) + '%';
            document.getElementById('bearProb').textContent = Math.round(probs.bear * 100) + '%';
            document.getElementById('chopProb').textContent = Math.round(probs.chop * 100) + '%';
        }

        // API Base URL
        const API_BASE = '/api';

        // Universe selector instance
        let universeSelector = null;
        let currentUniverse = localStorage.getItem('selectedUniverse') || 'SPX500';

        // Load data from API (with fallback to JSON)
        async function loadDashboardData(universe) {
            universe = universe || currentUniverse;

            try {
                // Update universe stats display
                const statsEl = document.getElementById('universe-stats');
                if (statsEl) {
                    statsEl.innerHTML = '<span class="universe-stat">Loading data...</span>';
                }

                // Try API first
                let data;
                try {
                    const response = await fetch(`${API_BASE}/dashboard/quant2?universe=${universe}`);
                    if (response.ok) {
                        data = await response.json();
                        console.log('Loaded from API:', data);
                    } else {
                        throw new Error('API not available');
                    }
                } catch (apiError) {
                    console.log('API unavailable, falling back to JSON file');
                    const response = await fetch('data/quant2_dashboard.json');
                    if (response.ok) {
                        data = await response.json();
                    } else {
                        throw new Error('No data available');
                    }
                }

                // Update universe stats
                if (statsEl && data.universe) {
                    statsEl.innerHTML = `
                        <span class="universe-stat">üìä <strong>${data.universe.name || universe}</strong></span>
                        <span class="universe-stat">üè∑Ô∏è ${data.ticker_count || data.universe.ticker_count || '?'} stocks</span>
                        <span class="universe-stat">üåç ${data.universe.region || 'Unknown'}</span>
                    `;
                }

                if (data.generated_at) {
                    const ts = new Date(data.generated_at).toLocaleString();
                    console.log("Data generated at:", ts);
                }

                const strategies = data.strategies;

                // 1. Regime
                if (strategies.regime && !strategies.regime.error) {
                    const r = strategies.regime;
                    const probs = r.probabilities || { "BULL": 0, "BEAR": 0, "CHOP": 0 };
                    updateRegime(r.current, {
                        bull: probs.BULL || probs.Bull || 0,
                        bear: probs.BEAR || probs.Bear || 0,
                        chop: probs.CHOP || probs.Chop || 0
                    });

                    document.getElementById('raRegime').textContent = r.current;
                    document.getElementById('raConf').textContent = Math.round(Math.max(...Object.values(probs)) * 100) + '%';
                    document.getElementById('raDays').textContent = r.n_observations || '--';
                }

                // 2. Stat Arb
                if (strategies.stat_arb && !strategies.stat_arb.error) {
                    const s = strategies.stat_arb;
                    document.getElementById('saClusters').textContent = s.n_clusters;
                    document.getElementById('saSignals').textContent = s.active_signals;
                }

                // 3. VRP
                if (strategies.vrp && !strategies.vrp.error) {
                    const v = strategies.vrp;
                    document.getElementById('vrpVix').textContent = v.current_vix;
                    document.getElementById('vrpPct').textContent = v.vix_percentile + '%';
                    document.getElementById('vrpSignal').textContent = v.signal;
                    document.getElementById('vrpTerm').textContent = v.term_structure;

                    const sigEl = document.getElementById('vrpSignal');
                    sigEl.className = 'metric-value ' + (v.signal === 'HARVEST' ? 'positive' : 'negative');
                }

                // 4. Meta Labeling
                if (strategies.meta_labeling) {
                    if (strategies.meta_labeling.status === 'ready') {
                        document.getElementById('mlSignals').textContent = "Ready";
                        document.getElementById('mlAccepted').textContent = "--";
                    }
                }

            } catch (e) {
                console.error('Error loading dashboard data:', e);
                const statsEl = document.getElementById('universe-stats');
                if (statsEl) {
                    statsEl.innerHTML = '<span class="universe-stat" style="color: var(--danger);">‚ö†Ô∏è Failed to load data</span>';
                }
            }
        }

        // Initialize universe selector
        async function initUniverseSelector() {
            if (typeof UniverseSelector === 'undefined') {
                console.warn('UniverseSelector not loaded, retrying...');
                setTimeout(initUniverseSelector, 100);
                return;
            }

            universeSelector = new UniverseSelector('universe-selector-container', {
                onSelect: (key, info) => {
                    console.log('Universe changed to:', key, info);
                    currentUniverse = key;
                    loadDashboardData(key);
                }
            });

            await universeSelector.init();
        }

        // Start initialization
        initUniverseSelector();
        loadDashboardData();
    </script>
</body>

</html>