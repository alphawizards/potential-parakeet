<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OLMAR Strategy Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a1a;
            --bg-secondary: #12122a;
            --bg-card: #1a1a3a;
            --accent: #00d4ff;
            --accent-alt: #7b68ee;
            --accent-olmar: #ff6b35;
            --success: #00ff88;
            --danger: #ff4466;
            --warning: #ffaa00;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --border: #2a2a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            padding: 20px 40px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-olmar);
        }

        .logo span {
            color: var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-olmar) 0%, var(--accent-alt) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
        }

        /* Main Layout */
        main {
            padding: 30px 40px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Page Title */
        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--accent-olmar);
        }

        .page-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-value.positive {
            color: var(--success);
        }

        .stat-value.negative {
            color: var(--danger);
        }

        .stat-value.neutral {
            color: var(--accent-olmar);
        }

        /* Section Title */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 30px 0 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent-olmar);
            border-radius: 2px;
        }

        /* Strategy Comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .strategy-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .strategy-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .strategy-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-olmar);
        }

        .strategy-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent-olmar);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .metric-item {
            text-align: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
        }

        /* Holdings Table */
        .holdings-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }

        .holdings-table th {
            background: var(--bg-secondary);
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--accent-olmar);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .holdings-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .holdings-table tr:last-child td {
            border-bottom: none;
        }

        .holdings-table tr:hover {
            background: rgba(255, 107, 53, 0.05);
        }

        .ticker {
            font-weight: 600;
            color: var(--accent);
        }

        .weight-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .weight-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-olmar), var(--accent-alt));
            border-radius: 4px;
        }

        /* Monthly Selection History */
        .month-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            margin-bottom: 12px;
        }

        .month-header {
            font-weight: 600;
            color: var(--accent-olmar);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .stock-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .stock-chip {
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stock-chip .ticker {
            font-weight: 600;
        }

        .stock-chip .weight {
            color: var(--text-secondary);
            font-size: 11px;
        }

        /* Frequency Table */
        .frequency-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            width: 100px;
        }

        .frequency-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }

        .tab {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab:hover {
            border-color: var(--accent-olmar);
        }

        .tab.active {
            background: var(--accent-olmar);
            color: white;
            border-color: var(--accent-olmar);
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-olmar);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Two Column Layout */
        .two-cols {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Responsive */
        @media (max-width: 1200px) {

            .comparison-grid,
            .two-cols {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 16px;
            }

            main {
                padding: 20px;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">OLMAR<span>Dash</span></div>
        <div class="nav-links">
            <a href="strategy_dashboard.html">üìä Main Dashboard</a>
            <a href="quallamaggie_scanner.html">üéØ Scanner</a>
            <a href="strategy_guide.html">üìö Guide</a>
            <button class="btn btn-primary" onclick="refreshData()">üîÑ Refresh Data</button>
        </div>
    </header>

    <main>
        <h1 class="page-title">OLMAR Strategy</h1>
        <p class="page-subtitle">On-Line Moving Average Reversion - Mean reversion strategy with cost-aware rebalancing
        </p>

        <!-- Overview Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">Best Strategy</div>
                <div class="stat-value neutral" id="bestStrategy">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">CAGR</div>
                <div class="stat-value positive" id="bestCagr">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Sharpe Ratio</div>
                <div class="stat-value positive" id="bestSharpe">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Max Drawdown</div>
                <div class="stat-value negative" id="maxDD">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Universe Size</div>
                <div class="stat-value neutral" id="universeSize">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Data Range</div>
                <div class="stat-value neutral" id="dataRange">--</div>
            </div>
        </div>

        <!-- Strategy Comparison -->
        <h2 class="section-title">Strategy Comparison</h2>
        <div class="comparison-grid" id="comparisonGrid">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Current Holdings -->
        <h2 class="section-title">Current Holdings</h2>
        <div class="tabs">
            <div class="tab active" onclick="switchHoldingsTab('weekly')">Weekly Rebalance</div>
            <div class="tab" onclick="switchHoldingsTab('monthly')">Monthly Rebalance</div>
        </div>
        <table class="holdings-table" id="holdingsTable">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Ticker</th>
                    <th>Weight</th>
                    <th>Allocation</th>
                </tr>
            </thead>
            <tbody id="holdingsBody">
                <tr>
                    <td colspan="4" class="loading">
                        <div class="spinner"></div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Monthly Selection History -->
        <h2 class="section-title">12-Month Stock Selection History</h2>
        <div class="tabs">
            <div class="tab active" onclick="switchHistoryTab('weekly')">Weekly Rebalance</div>
            <div class="tab" onclick="switchHistoryTab('monthly')">Monthly Rebalance</div>
        </div>
        <div id="selectionHistory">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Stock Frequency -->
        <h2 class="section-title">Most Frequently Selected Stocks</h2>
        <div class="two-cols">
            <div>
                <h3 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">Weekly Strategy</h3>
                <table class="holdings-table" id="weeklyFrequency">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Months Selected</th>
                            <th>Frequency</th>
                            <th>Avg Weight</th>
                        </tr>
                    </thead>
                    <tbody id="weeklyFrequencyBody"></tbody>
                </table>
            </div>
            <div>
                <h3 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">Monthly Strategy</h3>
                <table class="holdings-table" id="monthlyFrequency">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Months Selected</th>
                            <th>Frequency</th>
                            <th>Avg Weight</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyFrequencyBody"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        let data = null;
        let currentHoldingsTab = 'weekly';
        let currentHistoryTab = 'weekly';

        async function loadData() {
            try {
                const response = await fetch('olmar_data.json');
                if (!response.ok) throw new Error('Data not found');
                data = await response.json();
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Run "python -m strategy.olps.generate_dashboard_data" to generate data');
            }
        }

        function renderDashboard() {
            if (!data) return;

            // Update stats
            const weekly = data.strategies.weekly;
            const monthly = data.strategies.monthly;
            const best = weekly.metrics.sharpe > monthly.metrics.sharpe ? weekly : monthly;

            document.getElementById('bestStrategy').textContent = best.name;
            document.getElementById('bestCagr').textContent = best.metrics.cagr + '%';
            document.getElementById('bestSharpe').textContent = best.metrics.sharpe;
            document.getElementById('maxDD').textContent = best.metrics.max_drawdown + '%';
            document.getElementById('universeSize').textContent = data.universe_size;
            document.getElementById('dataRange').textContent =
                new Date(data.data_start).toLocaleDateString() + ' - ' +
                new Date(data.data_end).toLocaleDateString();

            // Render comparison cards
            renderComparisonCards();

            // Render holdings
            renderHoldings(currentHoldingsTab);

            // Render selection history
            renderSelectionHistory(currentHistoryTab);

            // Render frequency tables
            renderFrequencyTable('weekly');
            renderFrequencyTable('monthly');
        }

        function renderComparisonCards() {
            const grid = document.getElementById('comparisonGrid');

            grid.innerHTML = Object.entries(data.strategies).map(([key, s]) => `
                <div class="strategy-card">
                    <div class="strategy-card-header">
                        <span class="strategy-name">${s.name}</span>
                        <span class="strategy-badge">${s.rebalance_freq}</span>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-label">Total Return</div>
                            <div class="metric-value ${s.metrics.total_return >= 0 ? 'positive' : 'negative'}">${s.metrics.total_return}%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">CAGR</div>
                            <div class="metric-value ${s.metrics.cagr >= 0 ? 'positive' : 'negative'}">${s.metrics.cagr}%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Sharpe</div>
                            <div class="metric-value">${s.metrics.sharpe}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Volatility</div>
                            <div class="metric-value">${s.metrics.volatility}%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Max DD</div>
                            <div class="metric-value negative">${s.metrics.max_drawdown}%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Annual Turnover</div>
                            <div class="metric-value">${s.turnover_stats.annualized_turnover}%</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderHoldings(type) {
            const holdings = data.current_holdings[type];
            const tbody = document.getElementById('holdingsBody');

            if (!holdings || holdings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No holdings data</td></tr>';
                return;
            }

            const maxWeight = Math.max(...holdings.map(h => h.weight));

            tbody.innerHTML = holdings.map((h, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td class="ticker">${h.ticker}</td>
                    <td>${h.weight.toFixed(1)}%</td>
                    <td>
                        <div class="weight-bar">
                            <div class="weight-fill" style="width: ${(h.weight / maxWeight) * 100}%"></div>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderSelectionHistory(type) {
            const container = document.getElementById('selectionHistory');

            if (type === 'weekly' && data.weekly_selections) {
                // Show week-by-week data for weekly strategy
                const weeklyData = data.weekly_selections;

                if (!weeklyData || weeklyData.length === 0) {
                    container.innerHTML = '<p>No selection history available</p>';
                    return;
                }

                // Group weeks by month for organized display
                const monthGroups = {};
                weeklyData.forEach(week => {
                    const monthKey = week.month_name;
                    if (!monthGroups[monthKey]) {
                        monthGroups[monthKey] = [];
                    }
                    monthGroups[monthKey].push(week);
                });

                // Render each month with its weeks
                const months = Object.keys(monthGroups).reverse();
                container.innerHTML = months.map(monthName => `
                    <div class="month-card">
                        <div class="month-header" style="font-size: 16px; margin-bottom: 16px;">${monthName}</div>
                        ${monthGroups[monthName].slice().reverse().map(week => `
                            <div style="margin-bottom: 12px; padding-left: 12px; border-left: 2px solid var(--accent-olmar);">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">${week.week_name}</div>
                                <div class="stock-chips">
                                    ${week.stocks.map(s => `
                                        <div class="stock-chip">
                                            <span class="ticker">${s.ticker}</span>
                                            <span class="weight">${s.weight_pct}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            } else {
                // Show monthly data for monthly strategy
                const selections = data.monthly_selections[type];

                if (!selections || selections.length === 0) {
                    container.innerHTML = '<p>No selection history available</p>';
                    return;
                }

                container.innerHTML = selections.slice().reverse().map(month => `
                    <div class="month-card">
                        <div class="month-header">${month.month_name}</div>
                        <div class="stock-chips">
                            ${month.stocks.map(s => `
                                <div class="stock-chip">
                                    <span class="ticker">${s.ticker}</span>
                                    <span class="weight">${s.weight_pct}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderFrequencyTable(type) {
            const frequency = data.stock_frequency[type];
            const tbody = document.getElementById(type + 'FrequencyBody');

            if (!frequency || frequency.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No data</td></tr>';
                return;
            }

            tbody.innerHTML = frequency.slice(0, 15).map(s => `
                <tr>
                    <td class="ticker">${s.ticker}</td>
                    <td>${s.months_selected}</td>
                    <td>
                        <div class="frequency-bar">
                            <div class="frequency-fill" style="width: ${s.frequency_pct}%"></div>
                        </div>
                    </td>
                    <td>${s.avg_weight}%</td>
                </tr>
            `).join('');
        }

        function switchHoldingsTab(type) {
            currentHoldingsTab = type;
            document.querySelectorAll('.tabs')[0].querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.textContent.toLowerCase().includes(type));
            });
            renderHoldings(type);
        }

        function switchHistoryTab(type) {
            currentHistoryTab = type;
            document.querySelectorAll('.tabs')[1].querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.textContent.toLowerCase().includes(type));
            });
            renderSelectionHistory(type);
        }

        function showError(message) {
            document.getElementById('comparisonGrid').innerHTML =
                `<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--warning);">
                    ‚ö†Ô∏è ${message}
                </div>`;
        }

        async function refreshData() {
            const btn = document.querySelector('.btn-primary');
            btn.textContent = '‚è≥ Refreshing...';
            btn.disabled = true;

            try {
                // In a real app, this would trigger the Python script
                await loadData();
            } finally {
                btn.textContent = 'üîÑ Refresh Data';
                btn.disabled = false;
            }
        }

        // Initialize
        loadData();
    </script>
</body>

</html>